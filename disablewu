# Jalankan sebagai Administrator

# Hentikan layanan terkait Windows Update
Stop-Service -Name wuauserv -Force
Stop-Service -Name bits -Force
Stop-Service -Name dosvc -Force

# Set layanan menjadi Disabled
Set-Service -Name wuauserv -StartupType Disabled
Set-Service -Name bits -StartupType Disabled
Set-Service -Name dosvc -StartupType Disabled

# Nonaktifkan tugas terjadwal Windows Update
$tasks = @(
    "\Microsoft\Windows\WindowsUpdate\Scheduled Start",
    "\Microsoft\Windows\WindowsUpdate\sih",
    "\Microsoft\Windows\WindowsUpdate\sihboot"
)

foreach ($task in $tasks) {
    try {
        Disable-ScheduledTask -TaskPath $task.Substring(0, $task.LastIndexOf('\')+1) -TaskName ($task.Split('\')[-1]) -ErrorAction SilentlyContinue
    } catch {}
}

# Blokir domain Windows Update di file hosts
$hostsPath = "$env:WINDIR\System32\drivers\etc\hosts"
$blockedHosts = @(
    "windowsupdate.microsoft.com",
    "update.microsoft.com",
    "dl.delivery.mp.microsoft.com",
    "delivery.mp.microsoft.com",
    "s.update.microsoft.com",
    "fe2.update.microsoft.com",
    "fe3.delivery.dsp.mp.microsoft.com",
    "stats.update.microsoft.com"
)

$existingHosts = Get-Content $hostsPath -ErrorAction SilentlyContinue
$blockEntries = $blockedHosts | ForEach-Object {
    "127.0.0.1 `t$_"
}

# Tambahkan entri jika belum ada
foreach ($entry in $blockEntries) {
    if ($existingHosts -notcontains $entry) {
        Add-Content -Path $hostsPath -Value $entry
    }
}

Write-host "Windows Update telah dinonaktifkan dan domain terkait telah diblokir di file hosts." -foreground green
