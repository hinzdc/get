# Path untuk file setup.exe dan konfigurasi
$downloadPath = "C:\OfficeInstall"
$urlSetupExe = "https://raw.githubusercontent.com/hinzdc/get/main/office/setup.exe"

# Fungsi untuk mengunduh file dari URL
function DownloadFile {
    param (
        [string]$url,
        [string]$destination
    )
    try {
        (New-Object System.Net.WebClient).DownloadFile($url, $destination)
        return $true
    } catch {
        Write-Host " - Gagal mengunduh $url ke $destination. Error: $_" -ForegroundColor Red
        return $false
    }
}

# Fungsi untuk menginstal Office
function InstallOffice {
    # Tentukan URL configure.xml berdasarkan pilihan
    switch ($versionChoice) {
        "2016" { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2016.xml" }
        "2019" { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2019.xml" }
        "2021" { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2021homestudent.xml" }
        "365"  { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure365.xml" }
        default {
            Write-Host "Pilihan tidak valid untuk instalasi. Menghentikan Script." -ForegroundColor Red
            exit 1
        }
    }

    # Unduh file setup.exe dan configure.xml untuk instalasi
    $setupDownloaded = DownloadFile -url $urlSetupExe -destination "$downloadPath\setup.exe"
    $configDownloaded = DownloadFile -url $urlConfigureXml -destination "$downloadPath\configure.xml"

    # Cek apakah kedua file berhasil diunduh
    if ($setupDownloaded -and $configDownloaded) {
        Write-Host " + Semua file berhasil diunduh. Memulai instalasi..."
        
        # Eksekusi setup.exe untuk instalasi
        try {
            Start-Process -FilePath "$downloadPath\setup.exe" -ArgumentList "/configure $downloadPath\configure.xml" -Wait -NoNewWindow
            Write-Host " + Instalasi Office selesai." -ForegroundColor Green
        } catch {
            Write-Host " - Gagal menjalankan setup.exe untuk instalasi. Error: $_" -ForegroundColor Red
        }
    } else {
        Write-Host " - Gagal mengunduh satu atau lebih file." -ForegroundColor Red
    }
}

# Fungsi untuk menghapus instalasi Office
function UninstallOffice {
    $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configureremove.xml"
    
    # Unduh file setup.exe dan configure.xml untuk uninstall
    $setupDownloaded = DownloadFile -url $urlSetupExe -destination "$downloadPath\setup.exe"
    $configDownloaded = DownloadFile -url $urlConfigureXml -destination "$downloadPath\configureremove.xml"
    
    if ($setupDownloaded -and $configDownloaded) {
        Write-Host " + Semua file berhasil diunduh.."
        try {
            Write-Host " + Menghapus instalasi Office..."
            Start-Process -FilePath "$downloadPath\setup.exe" -ArgumentList "/configure $downloadPath\configureremove.xml" -Wait -NoNewWindow
            Write-Host " + Penghapusan instalasi Office selesai." -ForegroundColor Green
            
            # Menampilkan pesan popup setelah uninstall selesai
            $shell = New-Object -ComObject WScript.Shell
            $shell.Popup("UNINSTALL OFFICE SELESAI.", 10, "INFORMASI", 0) | Out-Null
        } catch {
            Write-Host " - Gagal menjalankan setup.exe untuk uninstall. Error: $_" -ForegroundColor Red
        }
    } else {
        Write-Host " - Gagal mengunduh satu atau lebih file." -ForegroundColor Red
    }
}

# Meminta pilihan versi dari pengguna
$versionChoice = Read-Host "Masukkan versi Office yang diinginkan (2016/2019/2021/365) atau R untuk uninstall:"

# Tentukan tindakan berdasarkan pilihan
switch ($versionChoice) {
    "R" { UninstallOffice }
    default { InstallOffice }
}

Write-Host "Script selesai." -ForegroundColor Green
