clear
Write-Host "                                             " -BackgroundColor Red
Write-Host "               MICROSOFT OFFICE              " -BackgroundColor Red -ForegroundColor White
Write-Host "             INSTALLER + ACTIVATOR           " -BackgroundColor Red -ForegroundColor White
Write-Host "                                             " -BackgroundColor Red

# Menu pilihan versi Office
Write-Host "---------------------------------------------"
Write-Host "Pilih versi Microsoft Office untuk diinstal:"
Write-Host "---------------------------------------------"
Write-Host "[1] Microsoft Office 2016 Professional Plus" -ForegroundColor Cyan
Write-Host "[2] Microsoft Office 2019 Professional Plus" -ForegroundColor Cyan
Write-Host "[3] Microsoft Office 2021 Professional Plus" -ForegroundColor Cyan
Write-Host "[4] Microsoft Office 2016 Home and Student" -ForegroundColor Cyan
Write-Host "[5] Microsoft Office 2019 Home and Student" -ForegroundColor Cyan
Write-Host "[6] Microsoft Office 2021 Home and Student" -ForegroundColor Cyan
Write-Host "---------------------------------------------"

$versionChoice = Read-Host "Masukkan nomor pilihan Anda (1-6). Lalu ENTER"

# Tentukan URL configure.xml berdasarkan pilihan
switch ($versionChoice) {
    1 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2016proplus.xml" }
    2 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2019proplus.xml" }
    3 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2021proplus.xml" }
    4 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2016homestudent.xml" }
    5 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2019homestudent.xml" }
    6 { $urlConfigureXml = "https://raw.githubusercontent.com/hinzdc/get/main/office/configure2021homestudent.xml" }
    default { 
        Write-Host "Pilihan tidak valid. Menghentikan skrip." -ForegroundColor Red
        exit 1 
    }
}

# Tentukan URL GitHub untuk file setup.exe
$urlSetupExe = "https://raw.githubusercontent.com/hinzdc/get/main/office/setup.exe"

# Tentukan lokasi di mana file akan diunduh
$downloadPath = "C:\OfficeInstall"

$startdate = Get-Date
Write-Host " START $startdate " -BackgroundColor White -ForegroundColor Black
Write-Host ""

# Buat folder temp jika belum ada
if (-not (Test-Path -Path $downloadPath)) {
    try {
        New-Item -Path $downloadPath -ItemType Directory -Force | Out-Null
        Write-Host " + Folder $downloadPath created successfully.." -ForegroundColor Green
    } catch {
        Write-Host " - Gagal membuat folder $downloadPath. Error: $_" -ForegroundColor Red
        exit 1
    }
}

# Fungsi untuk mengunduh file
function Download-File {
    param (
        [string]$url,
        [string]$destination
    )
    
    $fileName = [System.IO.Path]::GetFileName($destination)
    
    try {
        Write-Host " + Download file $fileName.."
        Invoke-WebRequest -Uri $url -OutFile $destination -ErrorAction Stop
        Write-Host " + File $fileName saved to $destination." -ForegroundColor Green
        return $true
    } catch {
        Write-Host " - Gagal mendownload file $fileName ke $destination. Error: $_" -ForegroundColor Red
        return $false
    }
}

# Unduh file setup.exe dan configure.xml
$setupDownloaded = Download-File -url $urlSetupExe -destination "$downloadPath\setup.exe"
$configDownloaded = Download-File -url $urlConfigureXml -destination "$downloadPath\configure.xml"

# Cek apakah kedua file telah berhasil diunduh
if ($setupDownloaded -and $configDownloaded) {
    Write-Host " + All files were successfully downloaded.."
    
    # Eksekusi setup.exe dengan menggunakan konfigurasi dari configure.xml
    try {
        Write-Host " + Installing Office.."
        Write-Host "   Please wait..."
        Start-Process -FilePath "$downloadPath\setup.exe" -ArgumentList "/configure $downloadPath\configure.xml" -Wait -NoNewWindow -ErrorAction Stop
        Write-Host " + Installing Office is complete.." -ForegroundColor Green
    } catch {
        Write-Host " - Gagal menjalankan setup.exe. Error: $_" -ForegroundColor Red
        exit 1
    }
    
    # Hentikan proses OfficeC2RClient.exe
    try {
        Write-Host " + Stoping OfficeC2RClient.exe Process.."
        $stopProcessJob = Start-Job -ScriptBlock {
            Stop-Process -Name "OfficeC2RClient" -Force -ErrorAction Stop | Out-Null
        }
        Wait-Job -Job $stopProcessJob | Out-Null
        Receive-Job -Job $stopProcessJob | Out-Null
        Remove-Job -Job $stopProcessJob | Out-Null
        Write-Host " + OfficeC2RClient.exe process is terminated..."
    } catch {
        Write-Host " - Gagal menghentikan proses OfficeC2RClient.exe. Error: $_" -ForegroundColor Red
    }

    # Cek apakah instalasi Microsoft Office telah selesai
    $officePath = "C:\Program Files\Microsoft Office\root\Office16"
    if (Test-Path -Path $officePath) {
        Write-Host " + Microsoft Office installed successfully.." -ForegroundColor Green
        Start-Sleep -Seconds 5
        Write-Host " + Create Shortcut..."
        # Define the paths to the Office applications
        $officeApps = @("C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE", 
                        "C:\Program Files\Microsoft Office\root\Office16\EXCEL.EXE", 
                        "C:\Program Files\Microsoft Office\root\Office16\POWERPNT.EXE")
        
        # Define the display names for the shortcuts
        $officeAppsDisplayNames = @("Word", "Excel", "PowerPoint")
        
        # Get the Desktop folder path
        $desktopPath = [System.Environment]::GetFolderPath("Desktop")
        
        # Create shortcuts on the Desktop
        for ($i = 0; $i -lt $officeApps.Length; $i++) {
            $shortcutPath = Join-Path -Path $desktopPath -ChildPath ("{0}.lnk" -f $officeAppsDisplayNames[$i])
            $shell = New-Object -ComObject WScript.Shell
            $shortcut = $shell.CreateShortcut($shortcutPath)
            $shortcut.TargetPath = $officeApps[$i]
            $shortcut.WorkingDirectory = Split-Path $officeApps[$i]
            $shortcut.Description = $officeAppsDisplayNames[$i]
            $shortcut.WindowStyle = 1
            $shortcut.Save()
        }
        # Eksekusi perintah setelah instalasi Microsoft Office selesai
        try {
            Write-Host " + Activating Office..." -ForegroundColor Green
            & ([ScriptBlock]::Create((irm https://get.activated.win))) /Ohook
            Write-Host "---------------------------------------------"
            Write-Host " INSTALL AND OFFICE ACTIVATION COMPLETE.. " -BackgroundColor Green -ForegroundColor White
            if (Test-Path -Path $downloadPath) {
                try {
                    Remove-Item -Path $downloadPath -Recurse -Force | Out-Null
                } catch {
                    exit 1
                }
            }
            Write-Host ""
            $enddate = Get-Date
            Write-Host " END $enddate " -BackgroundColor White -ForegroundColor Black
        } catch {
            Write-Host " - Gagal menjalankan perintah aktivasi. Error: $_" -ForegroundColor Red
        }
    } else {
        Write-Host " - Instalasi Microsoft Office gagal atau folder tidak ditemukan." -ForegroundColor Red
    }
} else {
    Write-Host " - Gagal mengunduh satu atau lebih file." -ForegroundColor Red
}
